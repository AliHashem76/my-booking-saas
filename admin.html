<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; margin: 0; padding: 20px; text-align: center; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { color: #2c3e50; }
        .section { margin-bottom: 30px; padding: 15px; border: 1px solid #eee; border-radius: 8px; }
        input, select, button { padding: 10px; margin: 5px; border-radius: 5px; border: 1px solid #ddd; width: 80%; max-width: 300px; }
        button { background-color: #27ae60; color: white; border: none; cursor: pointer; transition: 0.3s; width: auto; min-width: 150px; }
        button:hover { background-color: #219150; }
        .btn-delete { background-color: #e74c3c; padding: 5px 10px; min-width: 60px; }
        .btn-delete:hover { background-color: #c0392b; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: center; }
        th { background-color: #f8f9fa; color: #333; }
        tr:nth-child(even) { background-color: #f9f9f9; }
    </style>
</head>
<body>

<div class="container">
    <h2 id="welcomeMsg">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
    <p>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</p>
    <button onclick="logout()" style="background-color: #7f8c8d;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>

    <hr>

    <div class="section">
        <h3>â• Ø¥Ø¶Ø§ÙØ© Ø®Ø¯Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
        <input type="text" id="serviceName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø®Ø¯Ù…Ø© (Ù…Ø«Ù„Ø§Ù‹: Ø­Ù„Ø§Ù‚Ø© Ø°Ù‚Ù†)">
        <input type="number" id="servicePrice" placeholder="Ø§Ù„Ø³Ø¹Ø± ($)">
        <input type="number" id="serviceDuration" placeholder="Ø§Ù„Ù…Ø¯Ø© (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚)">
        <button onclick="addService()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø¯Ù…Ø©</button>
    </div>

    <div class="section">
        <h3>ğŸ“‹ Ø®Ø¯Ù…Ø§ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„Ø®Ø¯Ù…Ø©</th>
                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                    <th>Ø§Ù„Ù…Ø¯Ø©</th>
                    <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                </tr>
            </thead>
            <tbody id="servicesList">
                </tbody>
        </table>
    </div>

    <div class="section">
        <h3>ğŸ“… Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h3>
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„Ø²Ø¨ÙˆÙ†</th>
                    <th>Ø§Ù„Ø®Ø¯Ù…Ø©</th>
                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                </tr>
            </thead>
            <tbody id="bookingsList">
                </tbody>
        </table>
    </div>
</div>

<script>
    const businessId = localStorage.getItem('business_id');
    const businessName = localStorage.getItem('business_name');

    if (!businessId) {
        window.location.href = '/login';
    } else {
        document.getElementById('welcomeMsg').innerText = `Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… ${businessName}`;
    }

    // 1. Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø®Ø¯Ù…Ø§Øª
    async function loadServices() {
        const response = await fetch(`/business/${businessId}/services`);
        const services = await response.json();
        const list = document.getElementById('servicesList');
        list.innerHTML = '';

        services.forEach(s => {
            list.innerHTML += `
                <tr>
                    <td>${s.name}</td>
                    <td>${s.price}$</td>
                    <td>${s.duration} Ø¯Ù‚ÙŠÙ‚Ø©</td>
                    <td><button class="btn-delete" onclick="deleteService(${s.id})">Ø­Ø°Ù</button></td>
                </tr>
            `;
        });
    }

    // 2. Ø¥Ø¶Ø§ÙØ© Ø®Ø¯Ù…Ø©
    async function addService() {
        const name = document.getElementById('serviceName').value;
        const price = document.getElementById('servicePrice').value;
        const duration = document.getElementById('serviceDuration').value;

        if (!name || !price || !duration) {
            alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø§Ù†Ø§Øª");
            return;
        }

        const response = await fetch('/add-service/', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                business_id: parseInt(businessId),
                name: name,
                duration: parseInt(duration),
                price: parseFloat(price)
            })
        });

        if (response.ok) {
            alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø¯Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ…");
            document.getElementById('serviceName').value = '';
            document.getElementById('servicePrice').value = '';
            document.getElementById('serviceDuration').value = '';
            loadServices(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙˆØ±Ø§Ù‹
        }
    }

    // 3. Ø­Ø°Ù Ø®Ø¯Ù…Ø©
    async function deleteService(id) {
        if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø¯Ù…Ø©ØŸ")) return;
        const response = await fetch(`/services/${id}`, { method: 'DELETE' });
        if (response.ok) loadServices();
    }

    // 4. Ø¬Ù„Ø¨ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª
    async function loadBookings() {
        const response = await fetch(`/business/${businessId}/bookings`);
        const bookings = await response.json();
        const list = document.getElementById('bookingsList');
        list.innerHTML = '';

        bookings.forEach(b => {
            list.innerHTML += `
                <tr>
                    <td>${b.customer_name}<br><small>${b.customer_phone}</small></td>
                    <td>${b.service_name}</td>
                    <td>${b.booking_date}<br>${b.booking_time}</td>
                    <td>${b.status == 'confirmed' ? 'âœ… Ù…Ø¤ÙƒØ¯' : 'âŒ Ù…Ù„ØºÙ‰'}</td>
                </tr>
            `;
        });
    }

    function logout() {
        localStorage.clear();
        window.location.href = '/login';
    }

    // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¬Ù„Ø¨ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
    window.onload = () => {
        loadServices();
        loadBookings();
    };
</script>

</body>
</html>